#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# Importation des librairies
import os
from datetime import datetime
from file_manager import read_file, read_answers
from nlp_processing import tokenisation, nb_tokens
from browser import build_index_inv


if __name__ == '__main__':

    path_cacm = os.path.join('cacm', 'cacm.all')
    path_questions = os.path.join('cacm', 'query.text')
    path_answers = os.path.join('cacm', 'qrels.text')
    path_common_words = os.path.join('cacm', 'common_words')
    collection = read_file(path_cacm, [".T", ".W", ".K"])
    print(collection[39])
    # "The Secant Method for Simultaneous Nonlinear Equations. A procedure for the simultaneous solution. of a system of not-necessarily-linear equations, a generalization of the secant method for a single function of one variable, is given."
    questions = read_file(path_questions, [".W"])
    answers = read_answers(path_answers)
    collection_tokens = tokenisation(collection, path_common_words, stemming=True)
    print(collection_tokens[39])
    # ['secant', 'method', 'simultan', 'nonlinear', 'equat', 'procedur', 'simultan', 'solut', 'system', 'necessarili', 'linear', 'equat', 'general', 'secant', 'method', 'singl', 'function', 'variabl']
    print(nb_tokens(collection_tokens))
    # 108113
    index_inv = build_index_inv(collection_tokens)
    print(len(index_inv))
    # 5405
    print(index_inv['method'])
    # {16: 0.25, 26: 0.25, 28: 0.3333333333333333, 35: 0.2, 39: 0.1111111111111111, 42: 0.2, 52: 0.1, 82: 0.05263157894736842, 87: 0.14285714285714285, 88: 0.1111111111111111, 94: 0.13333333333333333, 95: 0.02040816326530612, 96: 0.02564102564102564, 102: 0.3333333333333333, 105: 0.25, 106: 0.05084745762711865, 117: 0.16666666666666666, 144: 0.014705882352941176, 177: 0.09090909090909091, 184: 0.14285714285714285, 202: 0.025, 220: 0.2, 226: 0.14285714285714285, 241: 0.06818181818181818, 242: 0.041666666666666664, 252: 0.047619047619047616, 266: 0.25, 286: 0.2, 313: 0.2, 314: 0.25, 330: 0.2, 332: 0.12121212121212122, 335: 0.07317073170731708, 336: 0.1111111111111111, 380: 0.0967741935483871, 388: 0.14285714285714285, 405: 0.04, 416: 0.16666666666666666, 435: 0.038461538461538464, 441: 0.03076923076923077, 462: 0.015151515151515152, 472: 0.3333333333333333, 490: 0.2, 492: 0.05128205128205128, 493: 0.2, 495: 0.017241379310344827, 497: 0.013333333333333334, 530: 0.2, 531: 0.010526315789473684, 533: 0.03658536585365854, 535: 0.125, 552: 0.3333333333333333, 606: 0.125, 615: 0.017241379310344827, 626: 0.08333333333333333, 661: 0.07142857142857142, 674: 0.1111111111111111, 677: 0.041666666666666664, 697: 0.1, 726: 0.037037037037037035, 727: 0.06666666666666667, 755: 0.0425531914893617, 780: 0.1111111111111111, 788: 0.14285714285714285, 794: 0.06451612903225806, 799: 0.02857142857142857, 828: 0.125, 852: 0.3333333333333333, 857: 0.0625, 867: 0.015625, 868: 0.16666666666666666, 891: 0.021739130434782608, 894: 0.02564102564102564, 895: 0.15384615384615385, 911: 0.3333333333333333, 934: 0.3333333333333333, 940: 0.03125, 949: 0.03571428571428571, 950: 0.06, 957: 0.2, 989: 0.3333333333333333, 1002: 0.03636363636363636, 1003: 0.016666666666666666, 1006: 0.058823529411764705, 1013: 0.025, 1015: 0.0625, 1021: 0.2, 1025: 0.04081632653061224, 1026: 0.07317073170731708, 1027: 0.3333333333333333, 1028: 0.03225806451612903, 1029: 0.014925373134328358, 1030: 0.02040816326530612, 1031: 0.058823529411764705, 1044: 0.09090909090909091, 1047: 0.03333333333333333, 1048: 0.021739130434782608, 1049: 0.08163265306122448, 1066: 0.010638297872340425, 1067: 0.03571428571428571, 1069: 0.16666666666666666, 1072: 0.025, 1073: 0.06666666666666667, 1098: 0.01, 1109: 0.041666666666666664, 1110: 0.11764705882352941, 1111: 0.10344827586206896, 1112: 0.025, 1115: 0.043478260869565216, 1116: 0.09523809523809523, 1117: 0.02631578947368421, 1134: 0.03389830508474576, 1143: 0.011235955056179775, 1147: 0.06382978723404255, 1148: 0.045454545454545456, 1155: 0.020833333333333332, 1159: 0.018518518518518517, 1169: 0.013157894736842105, 1171: 0.019230769230769232, 1181: 0.04878048780487805, 1184: 0.022222222222222223, 1196: 0.0196078431372549, 1197: 0.031746031746031744, 1206: 0.04225352112676056, 1211: 0.06666666666666667, 1230: 0.15000000000000002, 1231: 0.0625, 1234: 0.028169014084507043, 1236: 0.030303030303030304, 1242: 0.2, 1255: 0.025, 1257: 0.022222222222222223, 1271: 0.027777777777777776, 1272: 0.0125, 1274: 0.06060606060606061, 1278: 0.047619047619047616, 1280: 0.018867924528301886, 1285: 0.1111111111111111, 1286: 0.125, 1292: 0.09803921568627451, 1293: 0.1111111111111111, 1307: 0.010869565217391304, 1324: 0.012987012987012988, 1326: 0.02, 1331: 0.02, 1344: 0.02564102564102564, 1351: 0.07142857142857142, 1352: 0.07407407407407407, 1353: 0.07142857142857142, 1354: 0.017543859649122806, 1363: 0.06451612903225806, 1369: 0.03571428571428571, 1376: 0.2, 1386: 0.018867924528301886, 1387: 0.038461538461538464, 1401: 0.041666666666666664, 1402: 0.09090909090909091, 1403: 0.05454545454545454, 1408: 0.020618556701030927, 1416: 0.02702702702702703, 1423: 0.013157894736842105, 1425: 0.02631578947368421, 1429: 0.13333333333333333, 1432: 0.023255813953488372, 1437: 0.2, 1438: 0.1111111111111111, 1440: 0.03333333333333333, 1441: 0.1090909090909091, 1443: 0.058823529411764705, 1453: 0.014492753623188406, 1456: 0.013157894736842105, 1473: 0.05405405405405406, 1488: 0.03278688524590164, 1491: 0.037500000000000006, 1497: 0.023809523809523808, 1504: 0.01818181818181818, 1511: 0.09090909090909091, 1517: 0.056179775280898875, 1525: 0.04081632653061224, 1543: 0.009174311926605505, 1549: 0.0196078431372549, 1561: 0.2, 1563: 0.09090909090909091, 1568: 0.03125, 1569: 0.047619047619047616, 1576: 0.125, 1577: 0.1111111111111111, 1586: 0.05555555555555555, 1587: 0.07142857142857142, 1592: 0.030303030303030304, 1593: 0.11764705882352941, 1601: 0.030303030303030304, 1602: 0.029850746268656716, 1608: 0.01694915254237288, 1610: 0.1, 1612: 0.02631578947368421, 1619: 0.08, 1620: 0.13043478260869565, 1621: 0.023809523809523808, 1623: 0.01694915254237288, 1625: 0.037037037037037035, 1632: 0.05084745762711865, 1633: 0.09523809523809523, 1635: 0.11764705882352941, 1643: 0.058823529411764705, 1644: 0.034482758620689655, 1645: 0.047619047619047616, 1649: 0.02127659574468085, 1650: 0.06818181818181819, 1653: 0.017857142857142856, 1662: 0.05555555555555555, 1664: 0.02040816326530612, 1667: 0.03571428571428571, 1673: 0.02857142857142857, 1674: 0.015151515151515152, 1683: 0.018867924528301886, 1692: 0.0196078431372549, 1696: 0.021739130434782608, 1700: 0.009615384615384616, 1703: 0.02702702702702703, 1712: 0.045454545454545456, 1713: 0.02040816326530612, 1719: 0.024691358024691357, 1721: 0.03529411764705882, 1722: 0.03225806451612903, 1725: 0.032, 1726: 0.007936507936507936, 1729: 0.07142857142857142, 1735: 0.02702702702702703, 1739: 0.0392156862745098, 1744: 0.020833333333333332, 1748: 0.013333333333333334, 1754: 0.01639344262295082, 1785: 0.034482758620689655, 1786: 0.09302325581395349, 1790: 0.08333333333333333, 1803: 0.1, 1805: 0.02, 1806: 0.14285714285714285, 1807: 0.0379746835443038, 1808: 0.05263157894736842, 1809: 0.019230769230769232, 1811: 0.007874015748031496, 1816: 0.05263157894736842, 1817: 0.09090909090909091, 1825: 0.03529411764705882, 1828: 0.020833333333333332, 1834: 0.015625, 1836: 0.02, 1846: 0.011627906976744186, 1847: 0.010752688172043012, 1848: 0.1, 1863: 0.07142857142857142, 1868: 0.017857142857142856, 1871: 0.08163265306122448, 1873: 0.08695652173913043, 1879: 0.021052631578947368, 1886: 0.010416666666666666, 1888: 0.07352941176470588, 1893: 0.03571428571428571, 1899: 0.11764705882352941, 1901: 0.015151515151515152, 1905: 0.06666666666666667, 1910: 0.02631578947368421, 1923: 0.027777777777777776, 1929: 0.013513513513513514, 1930: 0.011363636363636364, 1931: 0.016129032258064516, 1932: 0.045454545454545456, 1933: 0.014925373134328358, 1935: 0.046511627906976744, 1936: 0.007042253521126761, 1942: 0.07142857142857142, 1947: 0.01818181818181818, 1958: 0.07142857142857142, 1966: 0.08333333333333333, 1968: 0.058823529411764705, 1973: 0.02564102564102564, 1975: 0.02631578947368421, 1976: 0.0234375, 1992: 0.045454545454545456, 1997: 0.012987012987012988, 2000: 0.09090909090909091, 2008: 0.05555555555555555, 2014: 0.07692307692307693, 2018: 0.057971014492753624, 2019: 0.014705882352941176, 2021: 0.09090909090909091, 2032: 0.02631578947368421, 2033: 0.0583941605839416, 2047: 0.08620689655172414, 2049: 0.08823529411764705, 2050: 0.03076923076923077, 2051: 0.010416666666666666, 2053: 0.010416666666666666, 2056: 0.1111111111111111, 2062: 0.017241379310344827, 2065: 0.009708737864077669, 2075: 0.125, 2083: 0.03389830508474576, 2086: 0.1, 2091: 0.014492753623188406, 2094: 0.0196078431372549, 2105: 0.015625, 2107: 0.07500000000000001, 2109: 0.046153846153846156, 2113: 0.008695652173913044, 2125: 0.015384615384615385, 2127: 0.01, 2128: 0.04081632653061224, 2136: 0.14285714285714285, 2137: 0.012987012987012988, 2141: 0.057692307692307696, 2142: 0.012345679012345678, 2145: 0.028846153846153848, 2153: 0.04285714285714286, 2158: 0.08, 2174: 0.022727272727272728, 2176: 0.010752688172043012, 2177: 0.01020408163265306, 2178: 0.010638297872340425, 2186: 0.023809523809523808, 2192: 0.038461538461538464, 2195: 0.03260869565217391, 2196: 0.008333333333333333, 2203: 0.07446808510638298, 2210: 0.011904761904761904, 2223: 0.07142857142857142, 2227: 0.022222222222222223, 2228: 0.05660377358490566, 2229: 0.04, 2233: 0.009708737864077669, 2245: 0.06315789473684211, 2248: 0.10638297872340426, 2249: 0.08333333333333333, 2250: 0.14285714285714285, 2251: 0.0392156862745098, 2252: 0.04938271604938271, 2258: 0.05128205128205128, 2261: 0.07407407407407407, 2262: 0.022222222222222223, 2266: 0.058823529411764705, 2267: 0.02564102564102564, 2268: 0.06153846153846154, 2273: 0.06944444444444445, 2274: 0.011627906976744186, 2276: 0.046153846153846156, 2280: 0.0625, 2282: 0.07692307692307693, 2285: 0.025, 2287: 0.014925373134328358, 2300: 0.015873015873015872, 2307: 0.0125, 2314: 0.006711409395973154, 2318: 0.029411764705882353, 2338: 0.12, 2340: 0.038461538461538464, 2346: 0.10526315789473684, 2353: 0.043478260869565216, 2359: 0.05376344086021506, 2369: 0.014285714285714285, 2395: 0.06451612903225806, 2400: 0.02040816326530612, 2401: 0.012658227848101266, 2408: 0.15151515151515152, 2433: 0.023255813953488372, 2434: 0.023809523809523808, 2437: 0.08045977011494253, 2453: 0.013513513513513514, 2454: 0.02, 2457: 0.041666666666666664, 2459: 0.1111111111111111, 2464: 0.08333333333333333, 2468: 0.1, 2469: 0.023255813953488372, 2482: 0.020833333333333332, 2484: 0.022727272727272728, 2494: 0.04, 2497: 0.02040816326530612, 2501: 0.011235955056179775, 2517: 0.046511627906976744, 2520: 0.058823529411764705, 2522: 0.01282051282051282, 2523: 0.03333333333333333, 2524: 0.0392156862745098, 2537: 0.028169014084507043, 2543: 0.07142857142857142, 2544: 0.019230769230769232, 2556: 0.03278688524590164, 2559: 0.018867924528301886, 2567: 0.05747126436781609, 2569: 0.09302325581395349, 2580: 0.0641025641025641, 2582: 0.06097560975609756, 2592: 0.024096385542168676, 2596: 0.10810810810810811, 2597: 0.03508771929824561, 2600: 0.1, 2606: 0.08045977011494253, 2610: 0.020833333333333332, 2611: 0.16666666666666666, 2616: 0.029411764705882353, 2623: 0.015384615384615385, 2631: 0.02531645569620253, 2633: 0.05263157894736842, 2641: 0.06666666666666667, 2642: 0.05, 2646: 0.038461538461538464, 2650: 0.044117647058823525, 2656: 0.01818181818181818, 2664: 0.10344827586206896, 2666: 0.022727272727272728, 2682: 0.02247191011235955, 2683: 0.04, 2685: 0.03333333333333333, 2686: 0.02127659574468085, 2688: 0.030303030303030304, 2692: 0.012903225806451613, 2695: 0.012987012987012988, 2696: 0.07272727272727272, 2697: 0.009259259259259259, 2699: 0.025, 2700: 0.041666666666666664, 2721: 0.008928571428571428, 2726: 0.06249999999999999, 2727: 0.027777777777777776, 2733: 0.0392156862745098, 2737: 0.02857142857142857, 2738: 0.05405405405405406, 2742: 0.014084507042253521, 2749: 0.1142857142857143, 2751: 0.04225352112676056, 2753: 0.0070921985815602835, 2766: 0.018867924528301886, 2770: 0.045454545454545456, 2772: 0.025, 2773: 0.14285714285714285, 2781: 0.1764705882352941, 2787: 0.04285714285714286, 2789: 0.14285714285714285, 2794: 0.011111111111111112, 2799: 0.03278688524590164, 2808: 0.10526315789473684, 2809: 0.02127659574468085, 2819: 0.016129032258064516, 2827: 0.013888888888888888, 2835: 0.023255813953488372, 2836: 0.022222222222222223, 2837: 0.018867924528301886, 2846: 0.012048192771084338, 2847: 0.16, 2851: 0.015625, 2865: 0.0136986301369863, 2877: 0.02, 2880: 0.02857142857142857, 2883: 0.05825242718446601, 2888: 0.034482758620689655, 2896: 0.024390243902439025, 2901: 0.015873015873015872, 2903: 0.014925373134328358, 2905: 0.10091743119266056, 2906: 0.014285714285714285, 2913: 0.029850746268656716, 2923: 0.02586206896551724, 2924: 0.05263157894736842, 2927: 0.014925373134328358, 2931: 0.018404907975460124, 2932: 0.034482758620689655, 2953: 0.045454545454545456, 2966: 0.01639344262295082, 2968: 0.0125, 2970: 0.046511627906976744, 2972: 0.07017543859649122, 2981: 0.027777777777777776, 2984: 0.05128205128205128, 2985: 0.010101010101010102, 2987: 0.011235955056179775, 2989: 0.022727272727272728, 2991: 0.029411764705882353, 2996: 0.023255813953488372, 3001: 0.023529411764705882, 3005: 0.011627906976744186, 3013: 0.017543859649122806, 3014: 0.05494505494505495, 3015: 0.025210084033613446, 3016: 0.0425531914893617, 3017: 0.027777777777777776, 3018: 0.022222222222222223, 3021: 0.017391304347826087, 3030: 0.03571428571428571, 3032: 0.010752688172043012, 3033: 0.01, 3037: 0.023809523809523808, 3045: 0.02127659574468085, 3046: 0.19047619047619047, 3053: 0.0125, 3054: 0.017543859649122806, 3066: 0.08, 3068: 0.018518518518518517, 3073: 0.015384615384615385, 3082: 0.02, 3083: 0.044444444444444446, 3084: 0.017543859649122806, 3087: 0.008130081300813009, 3089: 0.02040816326530612, 3096: 0.027777777777777776, 3098: 0.23636363636363641, 3100: 0.03076923076923077, 3101: 0.015151515151515152, 3102: 0.02564102564102564, 3104: 0.02040816326530612, 3107: 0.13513513513513514, 3108: 0.03571428571428571, 3111: 0.028169014084507043, 3115: 0.010869565217391304, 3126: 0.06451612903225806, 3132: 0.012195121951219513, 3134: 0.0449438202247191, 3138: 0.029126213592233007, 3139: 0.13559322033898305, 3147: 0.024390243902439025, 3152: 0.012987012987012988, 3158: 0.0392156862745098, 3167: 0.11428571428571428, 3171: 0.03125, 3175: 0.016666666666666666, 3176: 0.04918032786885246}

    # graphe_frequence_rang(index_inv, collection_tokens)
    # result = boolean_request("language", "AND", "Implementation", index_inv, 'T')
    # >>> boolean : time 0.2ms
    # doclist = vector_request('What articles exist which deal with TSS (Time Sharing System), '
    #                          'an operating system for IBM computers?',
    #                          'T', index_inv, path_common_words, collection_tokens,
    #                          'tfidf')
    # >>> tfidf : time 8.89s
    #doclist_norm = vector_request('what is the language of France ?', 'W', index_inv, path_common_words,
    #                              collection_tokens, 'tfidf_norm')
    # >>> tfidf_norm : time 13.63s
    #doc_list_f = vector_request('what is the language of France ?', 'W', index_inv, path_common_words,
    #                            collection_tokens, 'freq_norm')
    # >>> freq_norm : time 14.3s
    # print('boolean request : ', result)
    # print('vector request : ', doclist)
    # print('vector request with norm : ', doclist_norm)
    # print('vector request with freq : ', doc_list_f)

    # precision = compute_precision(questions, 'W', index_inv, path_common_words, collection_tokens, 'tfidf', answers)
    # print(precision)


